import { OpenAPIGenerator } from "@orpc/openapi";
import { appRouter } from "./routers";
import * as fs from "fs";
import * as path from "path";
import { ZodToJsonSchemaConverter } from "@orpc/zod/zod4";

// å› ç‚ºè¦ç”¨ awaitï¼Œæ‰€ä»¥è¦åŒ…ä¸€å€‹ç«‹å³åŸ·è¡Œçš„ async function
(async () => {
  try {
    const generator = new OpenAPIGenerator({
      schemaConverters: [new ZodToJsonSchemaConverter()],
    });

    // ğŸ”¥ é—œéµä¿®æ­£ï¼šåŠ ä¸Š await
    const doc = await generator.generate(appRouter, {
      info: {
        title: "My Project API",
        version: "1.0.0",
        description: "Generated by @orpc/openapi",
      },
      servers: [
        {
          url: "http://localhost:3000/api",
          description: "Local Development",
        },
      ],
    });

    const outputPath = path.join(process.cwd(), "public", "openapi.json");
    fs.writeFileSync(outputPath, JSON.stringify(doc, null, 2));

    console.log("âœ… OpenAPI Document Generated Successfully!");
  } catch (error) {
    console.error("âŒ Generation failed:", error);
  }
})();
